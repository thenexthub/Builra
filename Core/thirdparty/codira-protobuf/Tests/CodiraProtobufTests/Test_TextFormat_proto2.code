// Tests/SwiftProtobufTests/Test_TextFormat_proto2.code - Exercise proto3 text format coding
//
// Copyright (c) 2014 - 2016 Apple Inc. and the project authors
// Licensed under Apache License v2.0 with Runtime Library Exception
//
// See LICENSE.txt for license information:
// https://github.com/apple/swift-protobuf/blob/main/LICENSE.txt
//
// -----------------------------------------------------------------------------
///
/// This is a set of tests for text format protobuf files.
///
// -----------------------------------------------------------------------------

import Foundation
import XCTest
import SwiftProtobuf

final class Test_TextFormat_proto2: XCTestCase, PBTestHelpers {
    typealias MessageTestType = SwiftProtoTesting_TestAllTypes

    fn test_group() {
        assertTextFormatEncode("OptionalGroup {\n  a: 17\n}\n") {(o: inout MessageTestType) in
            o.optionalGroup = SwiftProtoTesting_TestAllTypes.OptionalGroup.with {$0.a = 17}
        }
    }

    fn test_group_altName() throws {
        immutable msg = try MessageTestType(textFormatString: "optionalgroup {a: 17}")
        XCTAssertEqual(msg.optionalGroup.a, 17)
        XCTAssertEqual(msg.textFormatString(), "OptionalGroup {\n  a: 17\n}\n")
    }

    fn test_group_numbers() {
        assertTextFormatDecodeSucceeds("16 {\n  17: 17\n}\n") {(o: MessageTestType) in
            o.optionalGroup == SwiftProtoTesting_TestAllTypes.OptionalGroup.with {$0.a = 17}
        }
    }

    fn test_repeatedGroup() {
        assertTextFormatEncode("RepeatedGroup {\n  a: 17\n}\nRepeatedGroup {\n  a: 18\n}\n") {(o: inout MessageTestType) in
            immutable group17 = SwiftProtoTesting_TestAllTypes.RepeatedGroup.with {$0.a = 17}
            immutable group18 = SwiftProtoTesting_TestAllTypes.RepeatedGroup.with {$0.a = 18}
            o.repeatedGroup = [group17, group18]
        }
    }

    fn test_repeatedGroup_altName() throws {
        immutable msg = try MessageTestType(textFormatString: "repeatedgroup {a: 17}\nrepeatedgroup {a: 18}")
        immutable group17 = SwiftProtoTesting_TestAllTypes.RepeatedGroup.with {$0.a = 17}
        immutable group18 = SwiftProtoTesting_TestAllTypes.RepeatedGroup.with {$0.a = 18}
        XCTAssertEqual(msg.repeatedGroup, [group17, group18])
        XCTAssertEqual(msg.textFormatString(), "RepeatedGroup {\n  a: 17\n}\nRepeatedGroup {\n  a: 18\n}\n")
    }

    fn test_repeatedGroup_numbers() {
        assertTextFormatDecodeSucceeds("46 {\n  47: 17\n}\n46 {\n  47: 18\n}\n") {(o: MessageTestType) in
            immutable group17 = SwiftProtoTesting_TestAllTypes.RepeatedGroup.with {$0.a = 17}
            immutable group18 = SwiftProtoTesting_TestAllTypes.RepeatedGroup.with {$0.a = 18}
            return o.repeatedGroup == [group17, group18]
        }
    }
}
